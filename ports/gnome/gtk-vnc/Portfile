# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id $

PortSystem              1.0

name                    gtk-vnc
version                 0.4.3
categories              gnome
platforms               darwin
maintainers             cal openmaintainer

description             gtk-vnc is a VNC viewer widget for GTK.
long_description        ${description} It is built using coroutines allowing it to be completely \
                        asynchronous while remaining single threaded. It provides a core C \
                        library, and bindings for Python (PyGTK).
homepage                http://live.gnome.org/gtk-vnc/
license                 GPL-2.1
master_sites            gnome
master_sites.mirror_subdir \
                        sources/${name}/[join [lrange [split ${version} .] 0 1] .]
distfiles               ${name}-${version}.tar.bz2
use_bzip2               yes
checksums               rmd160  f7cc379b43088b83628dc92fb10ece463b1ab8fc \
                        sha256  b9870d923d636d2e7547267d01c8cafdc06ad5b5b4987003ea3cd567bfbb6377

patchfiles              patch-coroutine_ucontext-c.diff \
                        patch-continuation-h.diff \
                        patch-vncmodule-c.diff

depends_build           port:intltool

depends_lib             port:py27-gtk

configure.env-append    PKG_CONFIG_PATH="${frameworks_dir}/Python.framework/Versions/2.7/lib/pkgconfig"
build.env-append        PKG_CONFIG_PATH="${frameworks_dir}/Python.framework/Versions/2.7/lib/pkgconfig"
build.args-append       NO_UNDEFINED_FLAGS=""

post-configure {
    reinplace -E "s#pygtk-codegen-2.0#${frameworks_dir}/Python.framework/Versions/2.7/bin/pygobject-codegen-2.0#g" "${worksrcpath}/src/Makefile"
}
# required to use some deprecated symbols the compiler would #error out of
configure.cflags-append -D_XOPEN_SOURCE

post-destroot {
    file mkdir "${destroot}${frameworks_dir}/Python.framework/Versions/2.7/lib"
    file rename "${destroot}${prefix}/lib/python2.7/site-packages" "${destroot}${frameworks_dir}/Python.framework/Versions/2.7/lib/python2.7"
}

